<!doctype html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <title>Inverter Analytics — Solar Monitoring</title>
    <style>
      body{font-family:system-ui,Segoe UI,Arial,sans-serif}
      main{padding:24px}
      .row{display:flex;gap:12px;flex-wrap:wrap;align-items:end;margin:12px 0}
      label{font-size:12px;color:#444;display:block;margin-bottom:4px}
      input,button{padding:8px 10px;border:1px solid #ccc;border-radius:8px}
      button{cursor:pointer}
      .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:16px}
      .card{border:1px solid #e5e5e5;border-radius:12px;padding:14px;background:#fff}
      .k{font-size:12px;color:#666}
      .v{font-size:22px;font-weight:700}
      .err{color:#b00020;margin-top:8px}
      .muted{color:#666;font-size:13px}
      code{background:#f5f5f5;padding:2px 6px;border-radius:6px}
    </style>
  </head>
  <body>
    <div id='nav-holder'></div>
    <script>
      fetch('/nav.html').then(r => r.text()).then(html => {
        document.getElementById('nav-holder').outerHTML = html;
      });
    </script>

    <main>
      <h1>Inverter Analytics</h1>
      <p class='muted'>Shows placeholder PR & CUF from <code>/api/inverter/analytics/summary</code> (we'll wire real SQL next).</p>

      <div class='row'>
        <div>
          <label for='plantId'>Plant ID</label>
          <input id='plantId' value='DEMO'/>
        </div>
        <div>
          <label for='days'>Window (days, 1–31)</label>
          <input id='days' type='number' min='1' max='31' value='3'/>
        </div>
        <div>
          <button id='btnLoad'>Load</button>
        </div>
        <div class='muted' id='status' style='margin-left:8px'></div>
      </div>

      <div id='error' class='err'></div>

      <div class='cards' id='cards' style='display:none'>
        <div class='card'><div class='k'>PR</div><div class='v' id='pr'>—</div></div>
        <div class='card'><div class='k'>CUF</div><div class='v' id='cuf'>—</div></div>
        <div class='card'><div class='k'>Energy Export (kWh)</div><div class='v' id='exp'>—</div></div>
        <div class='card'><div class='k'>Theoretical (kWh)</div><div class='v' id='theo'>—</div></div>
        <div class='card'><div class='k'>Capacity (MW)</div><div class='v' id='cap'>—</div></div>
        <div class='card'><div class='k'>From</div><div class='v' id='from'>—</div></div>
        <div class='card'><div class='k'>To</div><div class='v' id='to'>—</div></div>
      </div>
    </main>

    <script>
      const btn = document.getElementById('btnLoad');
      const status = document.getElementById('status');
      const err = document.getElementById('error');
      const cards = document.getElementById('cards');

      const el = id => document.getElementById(id);

      async function loadSummary(){
        const plantId = el('plantId').value.trim();
        const days = Math.max(1, Math.min(31, parseInt(el('days').value||'3',10)));
        err.textContent=''; status.textContent='Loading…'; cards.style.display='none';

        if(!plantId){ err.textContent='Please enter Plant ID'; status.textContent=''; return; }

        try{
          const url = \/api/inverter/analytics/summary?plantId=\&days=\\;
          const res = await fetch(url);
          if(!res.ok) throw new Error('API error '+res.status);
          const j = await res.json();

          el('pr').textContent = (j.PR ?? 0).toFixed ? (j.PR*100).toFixed(0)+'%' : String(j.PR);
          el('cuf').textContent = (j.CUF ?? 0).toFixed ? (j.CUF*100).toFixed(0)+'%' : String(j.CUF);
          el('exp').textContent = j.energyExportKWh?.toLocaleString?.() ?? j.energyExportKWh ?? '—';
          el('theo').textContent = j.theoreticalKWh?.toLocaleString?.() ?? j.theoreticalKWh ?? '—';
          el('cap').textContent = j.capacityMW ?? '—';
          el('from').textContent = new Date(j.from).toLocaleString();
          el('to').textContent = new Date(j.to).toLocaleString();

          status.textContent = \Plant \ • \ day(s)\;
          cards.style.display='';
        }catch(e){
          err.textContent = e.message || String(e);
          status.textContent='';
        }
      }

      btn.addEventListener('click', loadSummary);
      window.addEventListener('DOMContentLoaded', loadSummary);
    </script>
  </body>
</html>
