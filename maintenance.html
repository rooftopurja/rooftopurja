<!doctype html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <title>Maintenance — Solar Monitoring</title>
    <style>
      body{font-family:system-ui,Segoe UI,Arial,sans-serif}
      main{padding:24px}
      .row{display:flex;gap:12px;flex-wrap:wrap;align-items:end;margin:12px 0}
      label{font-size:12px;color:#444;display:block;margin-bottom:4px}
      input,button,select{padding:8px 10px;border:1px solid #ccc;border-radius:8px}
      button{cursor:pointer}
      table{border-collapse:collapse;width:100%;margin-top:16px}
      th,td{border:1px solid #e5e5e5;padding:8px;text-align:left;font-size:14px}
      th{background:#fafafa}
      .muted{color:#666;font-size:13px}
      .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px}
      .sev-Major{background:#ffe7cc}
      .sev-Minor{background:#fff2cc}
      .sev-Info{background:#eef7ee}
      .status-Fault{background:#ffd6d6}
      .status-OK{background:#e9f7e9}
      .status-Maintenance\ Due{background:#e9f3ff}
      .err{color:#b00020}
    </style>
  </head>
  <body>
    <div id='nav-holder'></div>
    <script>
      fetch('/nav.html').then(r => r.text()).then(html => {
        document.getElementById('nav-holder').outerHTML = html;
      });
    </script>

    <main>
      <h1>Maintenance</h1>
      <p class='muted'>PLC (AC & Pump) and LoRa maintenance feed from <code>/api/maintenance/overview</code>.</p>

      <div class='row'>
        <div>
          <label for='plantId'>Plant ID</label>
          <input id='plantId' value='DEMO'/>
        </div>
        <div>
          <label for='type'>Device Type</label>
          <select id='type'>
            <option value=''>All</option>
            <option value='plc'>PLC only</option>
            <option value='lora'>LoRa only</option>
          </select>
        </div>
        <div>
          <label for='topN'>Rows (max 200)</label>
          <input id='topN' type='number' min='1' max='200' value='20'/>
        </div>
        <div>
          <button id='btnLoad'>Load</button>
        </div>
        <div class='muted' id='status' style='margin-left:8px'></div>
      </div>

      <div id='error' class='err'></div>

      <table id='grid' style='display:none'>
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Source</th>
            <th>Device</th>
            <th>Status</th>
            <th>Severity</th>
            <th>Message</th>
            <th>Ack</th>
          </tr>
        </thead>
        <tbody id='gridBody'></tbody>
      </table>
    </main>

    <script>
      const btn = document.getElementById('btnLoad');
      const grid = document.getElementById('grid');
      const body = document.getElementById('gridBody');
      const status = document.getElementById('status');
      const errorBox = document.getElementById('error');

      function sevClass(s){ return 'pill sev-' + (s||'').replace(/[^A-Za-z]/g,''); }
      function stClass(s){ return 'pill status-' + (s||'').replace(/[^A-Za-z ]/g,''); }

      async function loadData() {
        const plantId = document.getElementById('plantId').value.trim();
        const type = document.getElementById('type').value;
        const top = Math.max(1, Math.min(200, parseInt(document.getElementById('topN').value || '20', 10)));
        errorBox.textContent = '';
        status.textContent = 'Loading...';
        grid.style.display = 'none';
        body.innerHTML = '';

        if (!plantId) { errorBox.textContent = 'Please enter Plant ID'; status.textContent=''; return; }

        try {
          const qs = new URLSearchParams({ plantId, top: String(top) });
          if (type) qs.set('type', type);
          const res = await fetch('/api/maintenance/overview?' + qs.toString());
          if (!res.ok) throw new Error('API error ' + res.status);
          const json = await res.json();
          const rows = json.data || [];
          rows.forEach(r => {
            const tr = document.createElement('tr');
            tr.innerHTML = \
              <td>\</td>
              <td>\</td>
              <td>\</td>
              <td><span class="\">\</span></td>
              <td><span class="\">\</span></td>
              <td>\</td>
              <td>\</td>\;
            body.appendChild(tr);
          });
          status.textContent = \\ rows\;
          grid.style.display = rows.length ? '' : 'none';
          if (!rows.length) errorBox.textContent = 'No data';
        } catch (e) {
          errorBox.textContent = e.message || String(e);
          status.textContent = '';
        }
      }

      btn.addEventListener('click', loadData);
      window.addEventListener('DOMContentLoaded', loadData);
    </script>
  </body>
</html>
