<header class="main-header">
  <nav class="navbar">
    <div class="navbar-logo">
      <img src="common/logo.png" alt="Rooftop Urja® Logo" class="logo-img" />
      <span>Solar Plant Dashboard</span>
    </div>

    <ul class="navbar-menu">
      <li><a href="meter.v2.html" id="link-meter">Meter</a></li>
      <li><a href="inverter_analytics.html" id="link-analytics">Inverter Analytics</a></li>
      <li><a href="inverter_data_overview.html" id="link-overview">Inverter Data Overview</a></li>
      <li><a href="inverter_faults.html" id="link-faults">Inverter Faults</a></li>
      <li><a href="maintenance.html" id="link-maintenance">Maintenance</a></li>
    </ul>

    <div class="user-dropdown">
      <button class="user-btn" id="userButton">👤 Account ▼</button>
      <div class="dropdown-content" id="userMenu">
        <a href="/.auth/me" id="profileLink">Profile</a>
        <a href="/.auth/logout" id="logoutLink">Logout</a>
      </div>
    </div>
  </nav>
</header>

<script>
async function checkAuth() {
  try {
    const res = await fetch('/.auth/me');
    const data = await res.json();
    const principal = data.clientPrincipal;
    const btn = document.getElementById('userButton');
    const profile = document.getElementById('profileLink');
    const logout = document.getElementById('logoutLink');

    if (principal) {
      const name = principal.userDetails || 'User';
      btn.innerHTML = `👤 ${name.split('@')[0]} ▼`;
      profile.style.display = 'block';
      logout.style.display = 'block';
    } else {
      btn.innerHTML = '🔐 Login';
      profile.style.display = 'none';
      logout.style.display = 'none';
      btn.onclick = () => (window.location.href = '/.auth/login/aad');
    }
  } catch (err) {
    console.error('Auth check failed', err);
  }
}
checkAuth();
</script>
