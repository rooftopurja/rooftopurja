<div class="user-dropdown">
  <button class="user-btn" id="userButton">👤 Account ▼</button>
  <div class="dropdown-content" id="userMenu">
    <a href="/.auth/me" id="profileLink">Profile</a>
    <a href="/.auth/logout" id="logoutLink">Logout</a>
  </div>
</div>

<script>
async function checkAuth() {
  try {
    const res = await fetch('/.auth/me');
    const data = await res.json();
    const principal = data.clientPrincipal;

    const btn = document.getElementById('userButton');
    const profile = document.getElementById('profileLink');
    const logout = document.getElementById('logoutLink');

    if (principal) {
      // logged in
      const name = principal.userDetails || 'User';
      btn.innerHTML = `👤 ${name.split('@')[0]} ▼`;
      profile.style.display = 'block';
      logout.style.display = 'block';
    } else {
      // not logged in
      btn.innerHTML = '🔐 Login';
      profile.style.display = 'none';
      logout.style.display = 'none';
      btn.onclick = () => (window.location.href = '/.auth/login/aad'); // Microsoft Entra ID login
    }
  } catch (err) {
    console.error('Auth check failed', err);
  }
}
checkAuth();
</script>
